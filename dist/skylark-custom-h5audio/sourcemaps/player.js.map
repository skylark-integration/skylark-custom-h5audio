{"version":3,"sources":["player.js"],"names":["define","langx","styler","noder","eventer","$","plugins","create","el","attr","element","document","createElement","name","undefined","Element","prototype","offset","this","getBoundingClientRect","scrollLeft","window","pageXOffset","documentElement","scrollTop","pageYOffset","top","left","css","getComputedStyle","style","CustomHtml5Audio","Plugin","inherit","klassName","pluginName","options","volume","autoPlay","notification","playList","_construct","elm","call","_index","_repeating","_shuffling","_played","_seeking","_rightClick","_apActive","selectors","_player","className","id","innerHTML","settings","_elm","appendChild","_playBtn","querySelector","_prevBtn","_nextBtn","_repeatBtn","_shuffleBtn","_volumeBtn","_plBtn","_curTime","_durTime","_trackTitle","_progressBar","_progressBarContaner","_preloadBar","_volumeBar","_volumeBarContaner","_playList","listenTo","playToggle","volumeToggle","repeatToggle","shuffleToggle","handlerBar","seek","seekingFalse","handlerVol","setVolume","prev","next","_imageDiv","renderPL","plToggle","_audio","Audio","isEmptyList","empty","src","file","preload","title","height","_volumeLength","error","update","doEnd","classList","add","remove","play","_plLi","html","tpl","forEach","item","i","push","replace","_pl","join","insertBefore","nextSibling","querySelectorAll","listHandler","evt","preventDefault","target","current","parseInt","parentNode","getAttribute","plActive","isDel","splice","removeChild","setAttribute","paused","index","width","_isDel","len","length","icon","image","interactive","_interactive","pause","Array","keys","Math","floor","random","_playBtnclassList","muted","repeat","contains","shuffle","lassList","shuffling","toggle","readyState","barlength","round","currentTime","duration","curMins","curSecs","mins","secs","buffered","loaded","end","moveBar","dir","value","clientX","offsetWidth","offsetHeight","clientY","which","destroy","register"],"mappings":"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","file":"../player.js","sourcesContent":["define([\n  \"skylark-langx\",\n  \"skylark-domx-styler\",\n  \"skylark-domx-noder\",\n  \"skylark-domx-eventer\",\n  \"skylark-domx-query\",\n  \"skylark-domx-plugins-base\"\n],function(langx,styler,noder, eventer,$ , plugins) {\n\n  'use strict'\n\n    var aphtml =\n    '  <div class=\"ap-inner\">'+\n    '    <div class=\"ap-panel\">'+\n    '      <div class=\"ap-item ap--playback\">'+\n    '        <button class=\"ap-controls ap-prev-btn\">'+\n    '          <i class=\"material-icons md-dark\">skip_previous</i>'+\n    '        </button>'+\n    '        <button class=\"ap-controls ap-toggle-btn\">'+\n    '            <i class=\"material-icons md-dark ap--play\">play_arrow</i>'+\n    '            <i class=\"material-icons md-dark ap--pause\">pause</i>'+\n    '        </button>'+\n    '        <button class=\"ap-controls ap-next-btn\">'+\n    '          <i class=\"material-icons md-dark\">skip_next</i>'+\n    '        </button>'+\n    '      </div>'+\n    '      <div class=\"ap-item ap--track\">'+\n    '        <div class=\"ap-info\">'+\n    '          <div class=\"ap-title\">Unknown</div>'+\n    '          <div class=\"ap-time\">'+\n    '            <span class=\"ap-time--current\">--</span>'+\n    '            <span> / </span>'+\n    '            <span class=\"ap-time--duration\">--</span>'+\n    '          </div>'+\n    ''+\n    '          <div class=\"ap-progress-container\">'+\n    '            <div class=\"ap-progress\">'+\n    '              <div class=\"ap-bar\"></div>'+\n    '              <div class=\"ap-preload-bar\"></div>'+\n    '            </div>'+\n    '          </div>'+\n    ''+\n    '        </div>'+\n    '      </div>'+\n    '      <div class=\"ap-item ap--settings\">'+\n    '        <div class=\"ap-controls ap-volume-container\">'+\n    '          <button class=\"ap-controls ap-volume-btn\">'+\n    '              <i class=\"material-icons md-dark ap--volume-on\">volume_up</i>'+\n    '              <i class=\"material-icons md-dark ap--volume-off\">volume_mute</i>'+\n    '          </button>'+\n    '          <div class=\"ap-volume\">'+\n    '            <div class=\"ap-volume-progress\"><div class=\"ap-volume-bar\"></div></div>'+\n    '          </div>'+\n    '        </div>'+\n    '        <button class=\"ap-controls ap-repeat-btn\">'+\n    '          <i class=\"material-icons md-dark\">repeat</i>'+\n    '        </button>'+\n    '        <button class=\"ap-controls ap-shuffle-btn\">'+\n    '          <i class=\"material-icons md-dark\">shuffle</i>'+\n    '        </button>'+\n    '        <button class=\"ap-controls ap-playlist-btn\">'+\n    '          <i class=\"material-icons md-dark\">queue_music</i>'+\n    '        </button>'+\n    '      </div>'+\n    '    </div>'+\n    '  </div>';\n\n\n  function create(el, attr) {\n    var element = document.createElement(el);\n    if(attr) {\n      for(var name in attr) {\n        if(element[name] !== undefined) {\n          element[name] = attr[name];\n        }\n      }\n    }\n    return element;\n  }\n\n  Element.prototype.offset = function() {\n    var el = this.getBoundingClientRect(),\n    scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n    scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n\n    return {\n      top: el.top + scrollTop,\n      left: el.left + scrollLeft\n    };\n  };\n\n  Element.prototype.css = function(attr) {\n    if(typeof attr === 'string') {\n      return getComputedStyle(this, '')[attr];\n    }\n    else if(typeof attr === 'object') {\n      for(var name in attr) {\n        if(this.style[name] !== undefined) {\n          this.style[name] = attr[name];\n        }\n      }\n    }\n  };\n\n\n  var CustomHtml5Audio = plugins.Plugin.inherit({\n    klassName : \"CustomHtml5Audio\",\n\n    pluginName : \"intg.custom_html5_audio\",\n\n    options : {\n      volume   : 0.5,\n      autoPlay : false,\n      notification: false,\n      playList : []\n    },\n\n    _construct: function(elm, options) {\n      //this.options = options\n      plugins.Plugin.prototype._construct.call(this,elm,options);\n\n      this._index = 0;\n      this._repeating = false;\n      this._shuffling = null;\n      this._played = [];\n      this._seeking = false;\n      this._rightClick = false;\n      this._apActive = false;\n\n\n      let $el = this.$(),\n          selectors = this.options.selectors;\n\n      this._player = create('div', {\n        'className': 'ap',\n        'id': 'ap',\n        'innerHTML': aphtml\n      });\n\n      if(this._apActive || this._player === null) {\n        return;\n      }\n\n      let settings = this.options;\n\n      this._elm.appendChild(this._player);\n\n      // get player elements\n      this._playBtn        = this._player.querySelector('.ap-toggle-btn');\n      this._prevBtn        = this._player.querySelector('.ap-prev-btn');\n      this._nextBtn        = this._player.querySelector('.ap-next-btn');\n      this._repeatBtn      = this._player.querySelector('.ap-repeat-btn');\n      this._shuffleBtn     = this._player.querySelector('.ap-shuffle-btn');\n      this._volumeBtn      = this._player.querySelector('.ap-volume-btn');\n      this._plBtn          = this._player.querySelector('.ap-playlist-btn');\n      this._curTime        = this._player.querySelector('.ap-time--current');\n      this._durTime        = this._player.querySelector('.ap-time--duration');\n      this._trackTitle     = this._player.querySelector('.ap-title');\n      this._progressBar    = this._player.querySelector('.ap-bar');\n      this._progressBarContaner    = this._player.querySelector('.ap-progress-container');\n      this._preloadBar     = this._player.querySelector('.ap-preload-bar');\n      this._volumeBar      = this._player.querySelector('.ap-volume-bar');\n      this._volumeBarContaner    = this._player.querySelector('.ap-volume-container');\n\n      this._playList = settings.playList;\n\n\n      this.listenTo($(this._playBtn),'click', this.playToggle);\n      this.listenTo($(this._volumeBtn),'click', this.volumeToggle);\n      this.listenTo($(this._repeatBtn),'click', this.repeatToggle);\n      this.listenTo($(this._shuffleBtn),'click', this.shuffleToggle);\n\n      this.listenTo($(this._progressBarContaner),'mousedown', this.handlerBar);\n      this.listenTo($(this._progressBarContaner),'mousemove', this.seek);\n      this.listenTo($(document),'mouseup', this.seekingFalse);\n\n      this.listenTo($(this._volumeBarContaner),'mousedown', this.handlerVol);\n      this.listenTo($(this._volumeBarContaner),'mousemove', this.setVolume);\n      this.listenTo($(document),'mouseup', this.seekingFalse);\n\n      this.listenTo($(this._prevBtn),'click', this.prev);\n      this.listenTo($(this._nextBtn),'click', this.next);\n\n      this._imageDiv = create('div', {\n        'className': 'ap-image'\n      })\n      this._elm.appendChild(this._imageDiv)\n\n      this._apActive = true;\n\n      // Create playlist\n      this.renderPL();\n      this.listenTo($(this._plBtn),'click', this.plToggle);\n\n      // Create audio object\n      this._audio = new Audio();\n      this._audio.volume = settings.volume;\n\n\n\n      if(this.isEmptyList()) {\n        this.empty();\n        return;\n      }\n\n      this._audio.src = this._playList[this._index].file;\n      this._audio.preload = 'auto';\n      this._trackTitle.innerHTML = this._playList[this._index].title;\n      this._volumeBar.style.height = this._audio.volume * 100 + '%';\n      this._volumeLength = this._volumeBar.css('height');\n\n      this.listenTo($(this._audio),'error', this.error);\n      this.listenTo($(this._audio),'timeupdate', this.update);\n      this.listenTo($(this._audio),'ended', this.doEnd);\n      this.listenTo($(this._audio),'play', () => {\n        this._playBtn.classList.add('playing');\n      }, false)\n      this.listenTo($(this._audio),'pause', () => {\n        this._playBtn.classList.remove('playing');\n      }, false)\n\n      if(settings.autoPlay) {\n        this._audio.play();\n        this._plLi[this._index].classList.add('pl-current');\n      }\n\n\n\n    },\n\n\n    /**\n     *  PlayList methods\n     */\n    renderPL : function () {\n      var html = [];\n      var tpl =\n        '<li data-track=\"{count}\">'+\n          '<div class=\"pl-number\">'+\n            '<div class=\"pl-count\">'+\n              '<i class=\"material-icons\">audiotrack</i>'+\n            '</div>'+\n            '<div class=\"pl-playing\">'+\n              '<div class=\"eq\">'+\n                '<div class=\"eq-bar\"></div>'+\n                '<div class=\"eq-bar\"></div>'+\n                '<div class=\"eq-bar\"></div>'+\n              '</div>'+\n            '</div>'+\n          '</div>'+\n          '<div class=\"pl-title\">{title}</div>'+\n          '<button class=\"pl-remove\">'+\n              '<i class=\"material-icons\">delete</i>'+\n          '</button>'+\n        '</li>';\n\n      this._playList.forEach(function(item, i) {\n        html.push(\n          tpl.replace('{count}', i).replace('{title}', item.title)\n        );\n      });\n\n      this._pl = create('div', {\n        'className': 'pl-container hide',\n        'id': 'pl',\n        'innerHTML': !this.isEmptyList() ? '<ul class=\"pl-list\">' + html.join('') + '</ul>' : '<div class=\"pl-empty\">PlayList is empty</div>'\n      });\n\n      this._elm.insertBefore(this._pl, this._player.nextSibling);\n\n      this._plLi = this._pl.querySelectorAll('li');\n\n      this.listenTo($(this._pl),'click', this.listHandler);\n    },\n\n    listHandler : function (evt) {\n      evt.preventDefault();\n      if(evt.target.className === 'pl-title') {\n        var current = parseInt(evt.target.parentNode.getAttribute('data-track'), 10);\n        this._index = current;\n        this.play();\n        this.plActive();\n      }\n      else {\n        var target = evt.target;\n        while(target.className !== this._pl.className) {\n          if(target.className === 'pl-remove') {\n            var isDel = parseInt(target.parentNode.getAttribute('data-track'), 10);\n\n            this._playList.splice(isDel, 1);\n            target.parentNode.parentNode.removeChild(target.parentNode);\n\n            this._plLi = this._pl.querySelectorAll('li');\n\n            [].forEach.call(this._plLi, function(el, i) {\n              el.setAttribute('data-track', i);\n            });\n\n            if(!this._audio.paused) {\n\n              if(this._isDel === this._index) {\n                this.play();\n              }\n\n            }\n            else {\n              if(this.isEmptyList()) {\n                this.empty();\n              }\n              else {\n                // audio.currentTime = 0;\n                this._audio.src = this._playList[index].file;\n                document.title = this._trackTitle.innerHTML = this._playList[index].title;\n                this._progressBar.style.width = 0;\n              }\n            }\n            if(this._isDel < this._index) {\n              this._index--;\n            }\n\n            return;\n          }\n          target = target.parentNode;\n        }\n\n      }\n    },\n\n    plActive : function () {\n      if(this._audio.paused) {\n        this._plLi[index].classList.remove('pl-current');\n        return;\n      }\n      var current = this._index;\n      for(var i = 0, len = this._plLi.length; len > i; i++) {\n        this._plLi[i].classList.remove('pl-current');\n      }\n      this._plLi[current].classList.add('pl-current');\n\n      this._imageDiv.innerHTML = ''\n      if (this._playList[current].icon) {\n        let image = create('img', {\n          src: this._playList[current].icon\n        })\n        this._imageDiv.appendChild(image)\n      }\n    },\n\n\n  /**\n   *  Player methods\n   */\n    error : function () {\n      if (!this.isEmptyList()){\n        this.next();\n      } \n    },\n\n\n   play : function () {\n\n      this._index = (this._index > this._playList.length - 1) ? 0 : this._index;\n      if(this._index < 0) this._index = this._playList.length - 1;\n\n      if(this.isEmptyList()) {\n        this.empty();\n        return;\n      }\n\n      this._played.push(this._index)\n\n      this._audio.src = this._playList[this._index].file;\n      this._audio.preload = 'auto';\n      document.title = this._trackTitle.innerHTML = this._playList[this._index].title;\n      this._audio.play();\n      ///notify(playList[index].title, {\n      ///  icon: playList[index].icon,\n      ///  body: 'Now playing',\n      ///  tag: 'music-player'\n      ///});\n      this.plActive();\n    },\n\n    prev : function () {\n      if (this._played.length > 1) {\n        this._index = this._played.splice(-2)[0];\n      } else {\n        this._index = 0;\n      }\n\n      this.play();\n    },\n\n    next : function (interactive) {\n      if (this._shuffling) {\n        if (this._shuffling.length === 0) {\n          if (this._repeating || this._interactive) {\n            this._shuffling = [...Array(this._playList.length).keys()]\n          } else {\n            this._audio.pause();\n            this.plActive();\n            \n            return;\n          }\n        }\n\n        let i = Math.floor(Math.random() * this._shuffling.length);\n        this._index = this._shuffling.splice(i, 1)[0];\n      } else {\n        if (this._index === this._playList.length - 1 && (!this._repeating && !this._interactive)) {\n          this._audio.pause();\n          this.plActive();\n          this._playBtn.classList.remove('playing');\n          return;\n        }\n\n        this._index = (this._index === this._playList.length - 1) ? 0 : this._index + 1;\n      }\n\n      this.play();\n    },\n\n    isEmptyList : function () {\n      return this._playList.length === 0;\n    },\n\n    empty : function () {\n      this._audio.pause();\n      this._audio.src = '';\n      this._trackTitle.innerHTML = 'queue is empty';\n      this._curTime.innerHTML = '--';\n      this._durTime.innerHTML = '--';\n      this._progressBar.style.width = 0;\n      this._preloadBar.style.width = 0;\n      this._pl.innerHTML = '<div class=\"pl-empty\">PlayList is empty</div>';\n    },\n\n    playToggle : function () {\n      if(this.isEmptyList()) {\n        return;\n      }\n      if(this._audio.paused) {\n        this._audio.play();\n        //notify(playList[index].title, {\n        //  icon: playList[index].icon,\n        //  body: 'Now playing'\n        //});\n        this._playBtn.classList.add('playing');\n      }\n      else {\n        this._audio.pause();\n        this._playBtnclassList.remove('playing');\n      }\n      this.plActive();\n    },\n\n    volumeToggle : function () {\n      if(this._audio.muted) {\n        if(parseInt(this._volumeLength, 10) === 0) {\n          this._volumeBar.style.height = '100%';\n          this._audio.volume = 1;\n        }\n        else {\n          this._volumeBar.style.height = this._volumeLength;\n        }\n        this._audio.muted = false;\n        this._volumeBtn.classList.remove('muted');\n      }\n      else {\n        this._audio.muted = true;\n        this._volumeBar.style.height = 0;\n        this._volumeBtn.classList.add('muted');\n      }\n    },\n\n    repeatToggle : function () {\n      var repeat = this._repeatBtn.classList;\n      if(repeat.contains('ap-active')) {\n        this._repeating = false;\n        repeat.remove('ap-active');\n      }\n      else {\n        this._repeating = true;\n        repeat.add('ap-active');\n      }\n    },\n\n    shuffleToggle :function () {\n      var shuffle = this._shuffleBtn.lassList;\n      if(shuffle.contains('ap-active')) {\n        shuffling = null;\n        shuffle.remove('ap-active');\n      }\n      else {\n        shuffling = [...Array(this._playList.length).keys()]\n        shuffle.add('ap-active');\n      }\n    },\n\n    plToggle : function () {\n      this._pl.classList.toggle('ap-active');\n      this._pl.classList.toggle('hide');\n    },\n\n    update : function () {\n      if(this._audio.readyState === 0) return;\n\n      var barlength = Math.round(this._audio.currentTime * (100 / this._audio.duration));\n      this._progressBar.style.width = barlength + '%';\n\n      var\n      curMins = Math.floor(this._audio.currentTime / 60),\n      curSecs = Math.floor(this._audio.currentTime - curMins * 60),\n      mins = Math.floor(this._audio.duration / 60),\n      secs = Math.floor(this._audio.duration - mins * 60);\n      (curSecs < 10) && (curSecs = '0' + curSecs);\n      (secs < 10) && (secs = '0' + secs);\n\n      this._curTime.innerHTML = curMins + ':' + curSecs;\n      this._durTime.innerHTML = mins + ':' + secs;\n\n      var buffered = this._audio.buffered;\n      if(buffered.length) {\n        var loaded = Math.round(100 * buffered.end(0) / this._audio.duration);\n        this._preloadBar.style.width = loaded + '%';\n      }\n    },\n\n    doEnd : function () {\n\n      this.next(false);\n\n    },\n\n    moveBar : function (evt, el, dir) {\n      var value;\n      if(dir === 'horizontal') {\n        value = Math.round( ((evt.clientX - el.offset().left) + window.pageXOffset) * 100 / el.parentNode.offsetWidth);\n        el.style.width = value + '%';\n        return value;\n      }\n      else {\n        var offset = (el.offset().top + el.offsetHeight)  - window.pageYOffset;\n        value = Math.round((offset - evt.clientY));\n        if(value > 100) value = 100;\n        if(value < 0) value = 0;\n        this._volumeBar.style.height = value + '%';\n        return value;\n      }\n    },\n\n    handlerBar : function (evt) {\n      this._rightClick = (evt.which === 3) ? true : false;\n      this._seeking = true;\n      this.seek(evt);\n    },\n\n    handlerVol : function (evt) {\n      this._rightClick = (evt.which === 3) ? true : false;\n      this._seeking = true;\n      this.setVolume(evt);\n    },\n\n    seek : function (evt) {\n      if(this._seeking && this._rightClick === false && this._audio.readyState !== 0) {\n        var value = this.moveBar(evt, this._progressBar, 'horizontal');\n        this._audio.currentTime = this._audio.duration * (value / 100);\n      }\n    },\n\n    seekingFalse : function () {\n      this._seeking = false;\n    },\n\n    setVolume : function (evt) {\n      this._volumeLength = this._volumeBar.css('height');\n      if(this._seeking && this._rightClick === false) {\n        var value = this.moveBar(evt, this._volumeBar.parentNode, 'vertical') / 100;\n        if(value <= 0) {\n          this._audio.volume = 0;\n          this._volumeBtn.classList.add('muted');\n        }\n        else {\n          if(this._audio.muted) this._audio.muted = false;\n          this._audio.volume = value;\n          this._volumeBtn.classList.remove('muted');\n        }\n      }\n    },\n\n\n\n    /* Destroy method. Clear All */\n    destroy : function () {\n      if(!this._apActive) return;\n\n\n      noder.remove(this._player);\n      noder.remove(this._pl);\n\n      this._audio.pause();\n      this._apActive = false;\n    }\n\n  });\n\n  plugins.register(CustomHtml5Audio);\n\n\n  return CustomHtml5Audio;\n\n});\n"]}